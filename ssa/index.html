<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSA Progress</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 1em;
    }

    .bar-container {
      width: 80%;
      margin: 1em auto;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 30px;
      width: 0%;
      transition: width 0.5s ease-in-out;
    }

    .progress-remaining {
      background: #1565c0; /* Denim blue */
    }

    .progress-elapsed {
      background: #f28b82; /* Soft coral red-orange */
    }

    .label {
      margin-top: 1em;
      font-size: 1.2em;
    }

  </style>
</head>
<body>
  <h1>SSA Full Retirement Age Progress</h1>

  <div class="bar-container">
    <div id="progress-remaining" class="progress-bar progress-remaining"></div>
  </div>
  <p id="label-remaining" class="label"></p>


  <div class="bar-container">
    <div id="progress-elapsed" class="progress-bar progress-elapsed"></div>
  </div>
  <p id="label-elapsed" class="label label-elapsed"></p>
  
  <canvas id="pieChart" width="200" height="200"></canvas>
  <p id="tableRemainingLabel" class="label"></p>

<script>
  // Constants
  const SSA_START = new Date(2025, 7); // August 1, 2025
  const SSA_END = new Date(2026, 7);   // August 1, 2026
  const SSA_TABLE_VALUE = 6.7;

  // DOM Elements
  const canvas = document.getElementById('pieChart');
  const ctx = canvas.getContext('2d');
  const barRemaining = document.getElementById("progress-remaining");
  const barElapsed = document.getElementById("progress-elapsed");
  const labelRemaining = document.getElementById("label-remaining");
  const labelElapsed = document.getElementById("label-elapsed");
  const labelTable = document.getElementById("tableRemainingLabel");

  // Utility: Get SSA progress metrics using a shared timestamp
  function getSSAProgress(startDate, endDate, now) {
    const totalMs = endDate - startDate;
    const elapsedMs = now - startDate;
    const remainingMs = endDate - now;

    const percentElapsed = Math.max(0, Math.min(100, (elapsedMs / totalMs) * 100));
    const percentRemaining = Math.max(0, Math.min(100, (remainingMs / totalMs) * 100));

    const daysElapsed = elapsedMs / (1000 * 60 * 60 * 24);
    const daysRemaining = remainingMs / (1000 * 60 * 60 * 24);

    const totalHoursElapsed = elapsedMs / (1000 * 60 * 60);
    const hours = Math.floor(totalHoursElapsed % 24);
    const minutes = Math.floor((totalHoursElapsed % 1) * 60);

    const tableRemaining = (percentRemaining / 100) * SSA_TABLE_VALUE;

    return {
      percentElapsed,
      percentRemaining,
      daysElapsed,
      daysRemaining,
      hours,
      minutes,
      tableRemaining
    };
  }

  // Draw pie chart
  function drawPie(percentRemaining) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const radius = canvas.width / 2;
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    const offset = -Math.PI / 2;
    const sweep = (percentRemaining / 100) * 2 * Math.PI;
    const startAngle = offset;
    const endAngle = offset - sweep;

    // Forfeiture Arc (Outer Ring)
    ctx.beginPath();
    ctx.fillStyle = '#1565c0'; // Denim
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fill();

    // Readiness Slice (Inner Arc)
    ctx.beginPath();
    ctx.fillStyle = '#D8B4DD'; // Coral
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, startAngle, endAngle, false);
    ctx.fill();
  }

  // Unified animation loop
  function updateSSAVisuals() {
    const now = new Date(); // Single timestamp for this frame
    const {
      percentElapsed,
      percentRemaining,
      daysElapsed,
      daysRemaining,
      hours,
      minutes,
      tableRemaining
    } = getSSAProgress(SSA_START, SSA_END, now);

    // Update bar charts
    barRemaining.style.width = `${percentRemaining}%`;
    barElapsed.style.width = `${percentElapsed}%`;

    // Update textual labels
    labelRemaining.textContent =
      `${percentRemaining.toFixed(7)}% of the SSA year remains (${daysRemaining.toFixed(2)} days left).`;

    labelElapsed.textContent =
      `In other words, ${percentElapsed.toFixed(7)}% of this final SSA year has been lived (${daysElapsed.toFixed(2)} days so far, including ${hours}h ${minutes}m).`;

    labelTable.textContent =
      `Retiring now would forfeit ${tableRemaining.toFixed(9)}% of my benefit.`;

    // Update pie chart
    drawPie(percentRemaining);

    requestAnimationFrame(updateSSAVisuals);
  }

  // Start animation
  updateSSAVisuals();
</script>

</body>
</html>
